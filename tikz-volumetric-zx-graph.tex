\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

\usepackage{ifthen}
\usepackage{xstring}

\usepackage{tikz}

\tikzstyle{edge}=[line cap = round, ultra thick]
\tikzstyle{identity}=[darkgray!90]
\tikzstyle{hadamard}=[yellow!75!black!75]

\tikzstyle{axis}=[line cap=round, thick]
\tikzstyle{U}=[lightgray]
\tikzstyle{X}=[  red!75!black!50]
\tikzstyle{Y}=[green!75!black!50]
\tikzstyle{Z}=[ blue!75!black!50]
\tikzstyle{O}=[darkgray!90, line width = 1pt]

\tikzset{
	% Graph parameters
	zx/graph/labels/.initial=hide,
	zx/graph/labels/.store in=\ShowNodeLabels,
	% Cube parameters
	zx/cube/labels/.store in=\ShowCubeLabels,
	zx/cube/x/.store in=\ColorX,
	zx/cube/y/.store in=\ColorY,
	zx/cube/z/.store in=\ColorZ,
	% Node parameters
	zx/node/type/.initial=R,
	zx/node/type/.store in=\NodeType,
	zx/node/identifier/.store in=\Identifier,
	% Edge parameters
	zx/edge/axis/.store in=\EdgeAxis, % Edge represents a change of +1/-1 between two adjacent spiders along an axis
	zx/edge/type/.store in=\EdgeType, % Edge can be identity or hadamard
	% Plane parameters
	zx/plane/node/.store in=\Identifier,
	zx/plane/normal/.store in=\NormalVector
}

\newcommand{\Cube}[2][]{
	\begingroup
		\tikzset{zx/cube/.cd, #1}

		\coordinate (center) at #2;

		\fill[\ColorX] (center) -- +(270: 0.175) -- +(210: 0.175) -- +(150 : 0.175);
		\fill[\ColorY] (center) -- +(30: 0.175) -- +(-30 : 0.175) -- +(270: 0.175);
		\fill[\ColorZ] (center) -- +(150: 0.175) -- +(90: 0.175) -- +(30 : 0.175);

		\draw[draw=black, line width = 0.25pt] (center) -- +( 30: 0.175);
		\draw[draw=black, line width = 0.25pt] (center) -- +(150: 0.175);
		\draw[draw=black, line width = 0.25pt] (center) -- +(270: 0.175);

		\draw[draw=black, line width = 0.25pt] ([shift={(30:0.175)}] center) -- +(150: 0.175);
		\draw[draw=black, line width = 0.25pt] ([shift={(30:0.175)}] center) -- +(270: 0.175);

		\draw[draw=black, line width = 0.25pt] ([shift={(150:0.175)}] center) -- +( 30: 0.175);
		\draw[draw=black, line width = 0.25pt] ([shift={(150:0.175)}] center) -- +(270: 0.175);

		\draw[draw=black, line width = 0.25pt] ([shift={(270:0.175)}] center) -- +( 30: 0.175);
		\draw[draw=black, line width = 0.25pt] ([shift={(270:0.175)}] center) -- +(150: 0.175);

		\ifdefined\ShowCubeLabels
			\IfStrEqCase{\ShowCubeLabels}{
				{show}{
					\node at ([shift={( 90: 0.0875)}] center) {\scriptsize\tt Z};
					\node at ([shift={(210: 0.0875)}] center) {\scriptsize\tt X};
					\node at ([shift={(330: 0.0875)}] center) {\scriptsize\tt Y};
				}
			}
		\fi
	\endgroup
}

\newcommand{\Node}[2][]{
	\begingroup
		\tikzset{zx/node/.cd, #1}

		\coordinate (node\Identifier) at #2;

		\ifthenelse{\equal{\NodeType}{O}}{
			\fill[\NodeType] (node\Identifier) circle (2pt);
		}{
			\fill[\NodeType] (node\Identifier) circle (3pt);
		}

		\node (\Identifier) at (node\Identifier) {};
		\ifdefined\ShowNodeLabels
			\IfStrEqCase{\ShowNodeLabels}{
				{show}{\node[white, scale=0.25] at (node\Identifier) {\tt\Identifier};}
				{hide}{}
			}
		\fi

	\endgroup
}

\newcommand{\Edge}[3][]{
	\begingroup
		\tikzset{zx/edge/.cd, #1}
		\draw[edge, white, line width = 2.25pt, shorten <= 6pt, shorten >= 6pt] (node#2) -- (node#3);
		\ifdefined\EdgeType
			\draw[edge, \EdgeType, shorten <= 6pt, shorten >= 6pt] (node#2) -- (node#3);
		\else
			\draw[edge, identity, shorten <= 6pt, shorten >= 6pt] (node#2) -- (node#3);
		\fi
		\ifdefined\EdgeAxis
			\draw[edge, thick, \EdgeAxis, shorten <= 6pt, shorten >= 6pt] (node#2) -- (node#3);
		\fi
	\endgroup
}

\newcommand{\Plane}[2][]{
	\begingroup
		\tikzset{zx/plane/.cd, #1}

		\draw[\NormalVector, line width = 1pt] (node\Identifier) circle (4pt);
	\endgroup
}

\newcommand{\ZXGraph}[2][]{
	\begingroup
		\tikzset{zx/graph/.cd, #1}
		\begin{tikzpicture}
			{#2} % Layout of the ZX-Graph (i.e. nodes and edges) along with plane-constraints
		\end{tikzpicture}
	\endgroup
}

% Correspondence between BlockGraph and Volumetric ZX-Graph notation.
\newcommand{\Legend}{
	\ZXGraph[labels=hide]{
		\Node[type=X, identifier=XZZ]{(0,+1.0)}
		\node at (0.375, 1) {$\equiv$};
		\Cube[x=X,y=Z,z=Z]{(0.75, 1.0)}

		\Node[type=X, identifier=ZXZ]{(0,+0.5)}
		\node at (0.375,0.5) {$\equiv$};
		\Cube[x=Z,y=X,z=Z]{(0.75, 0.5)}

		\Node[type=X, identifier=ZZX]{(0, 0.0)}
		\node at (0.375,0.0) {$\equiv$};
		\Cube[x=Z,y=Z,z=X]{(0.75, 0.0)}

		\Node[type=Z, identifier=ZXX]{(1.5,+1.0)}
		\node at (1.875, 1) {$\equiv$};
		\Cube[x=Z,y=X,z=X]{(2.25, 1.0)}

		\Node[type=Z, identifier=XZX]{(1.5,+0.5)}
		\node at (1.875,0.5) {$\equiv$};
		\Cube[x=X,y=Z,z=X]{(2.25, 0.5)}

		\Node[type=Z, identifier=XXZ]{(1.5, 0.0)}
		\node at (1.875,0.0) {$\equiv$};
		\Cube[x=X,y=X,z=Z]{(2.25, 0.0)}

		\begin{scope}[scale=2]
			\draw[-stealth] (-0.5, 0.25) -- +(210 : 0.3);
			\node at ([shift={(210: 0.35)}] -0.5, 0.25) {\tiny $x$};

			\draw[-stealth] (-0.5, 0.25) -- +(330: 0.3);
			\node at ([shift={(330: 0.35)}] -0.5, 0.25) {\tiny $y$};

			\draw[-stealth] (-0.5, 0.25) -- +(90: 0.3);
			\node at ([shift={(90: 0.35)}] -0.5, 0.25) {\tiny $z$};

			\Cube[x=X,y=Y,z=Z, labels=show]{(-0.5, +0.25)}
		\end{scope}

		% Plane constraints
		\Plane[node=XZZ, normal=X]{}
		\Plane[node=ZXZ, normal=Y]{}
		\Plane[node=ZZX, normal=Z]{}
		\Plane[node=ZXX, normal=X]{}
		\Plane[node=XZX, normal=Y]{}
		\Plane[node=XXZ, normal=Z]{}
	}
}